# GCP STT Websocket Streaming + Pygame UI Setup Guide

## ê°œìš”

HabitLinkê°€ ì´ì œ Google Cloud STT websocket ìŠ¤íŠ¸ë¦¬ë°ê³¼ pygame ê¸°ë°˜ ì‹¤ì‹œê°„ UIë¥¼ ì§€ì›í•©ë‹ˆë‹¤!

### ìƒˆë¡œìš´ ê¸°ëŠ¥

1. **ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° STT**: ìŒì„±ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ Google Cloudë¡œ ì „ì†¡í•˜ê³  ì¦‰ê°ì ì¸ í…ìŠ¤íŠ¸ ë³€í™˜
2. **ìë™ ì¬ì—°ê²°**: GCPì˜ 5ë¶„ ì œí•œì„ ìë™ìœ¼ë¡œ ê´€ë¦¬
3. **ì‹¤ì‹œê°„ 3D ì‹œê°í™”**: 
   - ìŒì„± í¬ê¸°ì— ë”°ë¼ ë³€í•˜ëŠ” 3D íŒŒë€ êµ¬
   - ì‹¤ì‹œê°„ íŒŒí˜• í‘œì‹œ
   - ë¶„ì„ í•­ëª© ê²€ì¶œ ì‹œ ìƒ‰ìƒ ë³€í™” (íŒŒë€ìƒ‰ â†’ ì—°í•œ ì´ˆë¡ìƒ‰)
   - ì˜¤ë¥¸ìª½ ìƒë‹¨ ì•Œë¦¼ ë©”ì‹œì§€
4. **ë³‘ë ¬ ì‹¤í–‰**: UIì™€ ì½˜ì†” ë¡œê·¸ê°€ ë™ì‹œì— ì‘ë™

## ì„¤ì¹˜

### 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
pip install -r requirements.txt
```

ìƒˆë¡œ ì¶”ê°€ëœ íŒ¨í‚¤ì§€:
- `pygame`: UI ì‹œê°í™”
- `pyaudio`: ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë°

### 2. PyAudio ì„¤ì¹˜ ë¬¸ì œ í•´ê²°

#### macOS:
```bash
brew install portaudio
pip install pyaudio
```

#### Ubuntu/Linux:
```bash
sudo apt-get install portaudio19-dev
pip install pyaudio
```

#### Windows:
```bash
pip install pipwin
pipwin install pyaudio
```

## ì‹¤í–‰ ë°©ë²•

### ê¸°ë³¸ ì‹¤í–‰ (UI í™œì„±í™”)

```bash
python main.py
```

í”„ë¡œê·¸ë¨ì´ ì‹œì‘ë˜ë©´:
1. UI í™œì„±í™” ì—¬ë¶€ ì„ íƒ (ê¸°ë³¸ê°’: Y)
2. ë¶„ì„ ëª¨ë“ˆ ì„ íƒ (1-6ë²ˆ)
3. í‚¤ì›Œë“œ ì…ë ¥ (í‚¤ì›Œë“œ ê²€ì¶œ ì„ íƒ ì‹œ)
4. ë°œí™” ì†ë„ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ (ë°œí™” ì†ë„ ë¶„ì„ ì„ íƒ ì‹œ)
5. pygame ì°½ì´ ì—´ë¦¬ê³  ì‹¤ì‹œê°„ ë¶„ì„ ì‹œì‘

### UI ì—†ì´ ì½˜ì†”ë§Œ ì‹¤í–‰

```bash
python main.py
# UI í™œì„±í™” (Y/n): n
```

## UI ì‚¬ìš©ë²•

### í™”ë©´ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HabitLink - ì‹¤ì‹œê°„ ìŒì„± ë¶„ì„          â”‚
â”‚                                        â”‚
â”‚              â•­â”€â”€â”€â”€â”€â•®                   â”‚  í‚¤ì›Œë“œ ê²€ì¶œ!
â”‚             â”‚  ğŸ”µ  â”‚                   â”‚  ë°œí™” ì†ë„ ë¹ ë¦„!
â”‚              â•°â”€â”€â”€â”€â”€â•¯                   â”‚
â”‚            â”â”â”â”â”â”â”â”â”â”                  â”‚
â”‚          (ì‹¤ì‹œê°„ íŒŒí˜•)                  â”‚
â”‚                                        â”‚
â”‚        Volume: 45%                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‹œê°ì  í”¼ë“œë°±

1. **êµ¬ì˜ í¬ê¸°**: ìŒì„± ë³¼ë¥¨ì— ë¹„ë¡€í•˜ì—¬ ì»¤ì§€ê³  ì‘ì•„ì§
2. **êµ¬ì˜ ìƒ‰ìƒ**: 
   - í‰ìƒì‹œ: íŒŒë€ìƒ‰ (Dodger Blue)
   - ê²€ì¶œ ì‹œ: ì—°í•œ ì´ˆë¡ìƒ‰ (2ì´ˆê°„ ìœ ì§€)
3. **íŒŒí˜•**: êµ¬ì˜ ì§€ë¦„ì„ ê°€ë¡œì§€ë¥´ëŠ” ì‹¤ì‹œê°„ ìŒì„± íŒŒí˜•
4. **ì•Œë¦¼**: ì˜¤ë¥¸ìª½ ìœ„ì— ê²€ì¶œëœ í•­ëª© í‘œì‹œ

### ì¢…ë£Œ

- UI ì°½ì˜ X ë²„íŠ¼ í´ë¦­
- ESC í‚¤ ëˆ„ë¥´ê¸°
- ì½˜ì†”ì—ì„œ Ctrl+C

## ì•„í‚¤í…ì²˜

### ìŠ¤íŠ¸ë¦¬ë° íŒŒì´í”„ë¼ì¸

```
ë§ˆì´í¬ ì…ë ¥ â†’ PyAudio â†’ GCP STT Websocket
                  â†“
            (ì¬ì—°ê²° ë¡œì§)
                  â†“
          ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ â† STT ì‘ë‹µ
                  â†“
           ë¶„ì„ íŒŒì´í”„ë¼ì¸
          (í‚¤ì›Œë“œ, ë¹„ì†ì–´ ë“±)
                  â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
         â†“             â†“
    ì½˜ì†” ë¡œê·¸      pygame UI
```

### ìŠ¤ë ˆë“œ êµ¬ì¡°

1. **Main Thread**: ì½˜ì†” í”¼ë“œë°± ë£¨í”„
2. **Streaming Thread**: GCP STT ìŠ¤íŠ¸ë¦¬ë° (ì¬ì—°ê²° ê´€ë¦¬)
3. **Audio Capture Thread**: ë§ˆì´í¬ì—ì„œ ì˜¤ë””ì˜¤ ìº¡ì²˜
4. **UI Thread**: pygame ì‹œê°í™”
5. **Analysis Tasks**: ë¹„ë™ê¸° ë¶„ì„ ì‘ì—…ë“¤

## ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. GoogleSTTStreaming (`src/stt.py`)

ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° STT í´ë˜ìŠ¤
- **ì¬ì—°ê²° ë¡œì§**: 4ë¶„ë§ˆë‹¤ ìë™ ì¬ì—°ê²° (GCP 5ë¶„ ì œí•œ ëŒ€ì‘)
- **ì½œë°± ê¸°ë°˜**: í…ìŠ¤íŠ¸ê°€ ì¸ì‹ë˜ë©´ ì¦‰ì‹œ ì½œë°± í˜¸ì¶œ
- **Interim/Final êµ¬ë¶„**: ì¤‘ê°„ ê²°ê³¼ì™€ ìµœì¢… ê²°ê³¼ ë¶„ë¦¬

```python
def callback(transcript, is_final, speaker):
    if is_final:
        print(f"ìµœì¢…: {transcript}")
    else:
        print(f"ì¤‘ê°„: {transcript}")

streaming_stt = GoogleSTTStreaming(callback=callback)
streaming_stt.start_streaming()
```

### 2. VoiceVisualizer (`src/ui_visualizer.py`)

Pygame ê¸°ë°˜ ì‹¤ì‹œê°„ UI
- **3D êµ¬ ë Œë”ë§**: ê·¸ë˜ë””ì–¸íŠ¸ íš¨ê³¼ë¡œ ì…ì²´ê°
- **ì‹¤ì‹œê°„ íŒŒí˜•**: numpy ë°°ì—´ì„ ì‹œê°í™”
- **ì•Œë¦¼ ì‹œìŠ¤í…œ**: í ê¸°ë°˜ ë©”ì‹œì§€ í‘œì‹œ
- **60 FPS**: ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜

### 3. HabitLinkSession (`src/session.py`)

ìŠ¤íŠ¸ë¦¬ë° ì„¸ì…˜ ê´€ë¦¬
- **ë²„í¼ë§**: ìµœê·¼ 30ì´ˆ ì˜¤ë””ì˜¤ ë° í…ìŠ¤íŠ¸ ë²„í¼
- **ë¶„ì„ ìŠ¤ì¼€ì¤„ë§**: 
  - ë¹ ë¥¸ ë¶„ì„ (í‚¤ì›Œë“œ, ë¹„ì†ì–´): 2ì´ˆë§ˆë‹¤
  - ëŠë¦° ë¶„ì„ (ë¬¸ë²•, ë§¥ë½): 10ì´ˆë§ˆë‹¤
- **ë©€í‹° í**: ì½˜ì†”ìš© íì™€ UIìš© í ë¶„ë¦¬

## ë¶„ì„ í•­ëª©ë³„ UI í”¼ë“œë°±

| ë¶„ì„ í•­ëª© | ì•Œë¦¼ ë©”ì‹œì§€ | ìƒ‰ìƒ ë³€í™” |
|---------|----------|---------|
| í‚¤ì›Œë“œ ê²€ì¶œ | "í‚¤ì›Œë“œ ê²€ì¶œ: 'ê·¸ë‹ˆê¹Œ'" | âœ… |
| ë¹„ì†ì–´ ê²€ì¶œ | "ë¹„ì†ì–´ ê²€ì¶œ: '***'" | âœ… |
| ë°œí™” ì†ë„ | "ë°œí™” ì†ë„ê°€ ë¹ ë¦…ë‹ˆë‹¤" | âœ… |
| ë¬¸ë²• ì˜¤ë¥˜ | "ë¬¸ë²• ì˜¤ë¥˜ 3ê°œ ë°œê²¬" | âœ… |
| ë§¥ë½ ì˜¤ë¥˜ | "ë§¥ë½ ì˜¤ë¥˜ 2ê°œ ë°œê²¬" | âœ… |
| ë§ë”ë“¬ | "ë§ë”ë“¬ ì´ë²¤íŠ¸ ê²€ì¶œ" | âœ… |

## ì œí•œì‚¬í•­ ë° ì•Œë ¤ì§„ ì´ìŠˆ

### GCP STT ìŠ¤íŠ¸ë¦¬ë° ì œí•œ

1. **5ë¶„ ì œí•œ**: ë‹¨ì¼ ìŠ¤íŠ¸ë¦¬ë° ì—°ê²°ì€ ìµœëŒ€ 5ë¶„
   - **í•´ê²°**: 4ë¶„ë§ˆë‹¤ ìë™ ì¬ì—°ê²°
2. **í™”ì ë¶„ë¦¬**: ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œì—ì„œëŠ” í™”ì ë¶„ë¦¬ ì œí•œì 
   - **í•´ê²°**: í˜„ì¬ëŠ” ë‹¨ì¼ í™”ìë¡œ ì²˜ë¦¬ (í–¥í›„ ê°œì„  ì˜ˆì •)
3. **ë„¤íŠ¸ì›Œí¬ ì˜ì¡´**: ì¸í„°ë„· ì—°ê²° í•„ìˆ˜

### PyAudio ì´ìŠˆ

- **Overflow ê²½ê³ **: ì‹œìŠ¤í…œì´ ëŠë¦° ê²½ìš° ë°œìƒ ê°€ëŠ¥
  - ì½”ë“œì—ì„œ `exception_on_overflow=False`ë¡œ ì²˜ë¦¬ë¨

### Pygame UI

- **ë©”ì¸ ìŠ¤ë ˆë“œ ê¶Œì¥**: macOSì—ì„œëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ ê¶Œì¥
  - í˜„ì¬ êµ¬ì¡°ì—ì„œëŠ” ë³„ë„ ìŠ¤ë ˆë“œë¡œ ì‹¤í–‰ë˜ì§€ë§Œ ëŒ€ë¶€ë¶„ ë¬¸ì œì—†ìŒ

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì˜¤ë””ì˜¤ê°€ ìº¡ì²˜ë˜ì§€ ì•ŠìŒ

```bash
# macOS: ë§ˆì´í¬ ê¶Œí•œ í™•ì¸
System Preferences â†’ Security & Privacy â†’ Privacy â†’ Microphone

# ì‚¬ìš© ê°€ëŠ¥í•œ ì˜¤ë””ì˜¤ ì¥ì¹˜ í™•ì¸
python -c "import pyaudio; p = pyaudio.PyAudio(); print([p.get_device_info_by_index(i)['name'] for i in range(p.get_device_count())])"
```

### GCP ì¸ì¦ ì˜¤ë¥˜

```bash
# ì¸ì¦ í™•ì¸
gcloud auth application-default login

# ë˜ëŠ” ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ì‚¬ìš©
export GOOGLE_APPLICATION_CREDENTIALS="path/to/gcp_credentials.json"
```

### UI ì°½ì´ ì—´ë¦¬ì§€ ì•ŠìŒ

```bash
# pygame ì¬ì„¤ì¹˜
pip uninstall pygame
pip install pygame

# macOSì—ì„œ XQuartz í•„ìš”í•  ìˆ˜ ìˆìŒ
brew install --cask xquartz
```

### ì¬ì—°ê²°ì´ ì‹¤íŒ¨í•¨

- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
- GCP í• ë‹¹ëŸ‰ í™•ì¸ (ë¬´ë£Œ í‹°ì–´: ì›” 60ë¶„)
- ë°©í™”ë²½ ì„¤ì • í™•ì¸

## ì„±ëŠ¥ ìµœì í™”

### ë‚®ì€ ì§€ì—°ì‹œê°„ ì›í•˜ëŠ” ê²½ìš°

1. **ì²­í¬ í¬ê¸° ì¡°ì •** (`src/stt.py`):
   ```python
   CHUNK = int(RATE / 10)  # 100ms â†’ 50msë¡œ ë³€ê²½
   CHUNK = int(RATE / 20)
   ```

2. **ë¶„ì„ ë¹ˆë„ ì¡°ì •** (`src/session.py`):
   ```python
   if time_since_last_analysis > 2.0:  # 2ì´ˆ â†’ 1ì´ˆ
       await self._run_fast_analysis()
   ```

### ë†’ì€ ì •í™•ë„ ì›í•˜ëŠ” ê²½ìš°

1. **ë” í° ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©**:
   ```python
   # src/session.py
   if time_since_last_analysis > 10.0:  # 10ì´ˆ â†’ 15ì´ˆ
       await self._run_slow_analysis()
   ```

## ë‹¤ìŒ ë‹¨ê³„

- [ ] ìŠ¤íŠ¸ë¦¬ë° ì¤‘ í™”ì ë¶„ë¦¬ ê°œì„ 
- [ ] UI ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜µì…˜ ì¶”ê°€
- [ ] ì„¸ì…˜ ë…¹í™” ë° ì¬ìƒ ê¸°ëŠ¥
- [ ] ì‹¤ì‹œê°„ ìŠ¤í™íŠ¸ë¡œê·¸ë¨ ì¶”ê°€
- [ ] ë‹¤êµ­ì–´ ì§€ì›

## ì°¸ê³  ìë£Œ

- [Google Cloud STT Streaming](https://cloud.google.com/speech-to-text/docs/streaming-recognize)
- [PyAudio Documentation](https://people.csail.mit.edu/hubert/pyaudio/docs/)
- [Pygame Documentation](https://www.pygame.org/docs/)

## ê¸°ì—¬

ë²„ê·¸ ë¦¬í¬íŠ¸ë‚˜ ê¸°ëŠ¥ ì œì•ˆì€ í™˜ì˜í•©ë‹ˆë‹¤!

---

Made with â¤ï¸ by HabitLink Team

